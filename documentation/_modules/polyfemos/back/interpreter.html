
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>polyfemos.back.interpreter &#8212; polyfemos 0.3.29 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for polyfemos.back.interpreter</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># This file is part of Polyfemos.</span>
<span class="c1">#</span>
<span class="c1"># Polyfemos is free software: you can redistribute it and/or modify it under</span>
<span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
<span class="c1"># Software Foundation, either version 3 of the License, or any later version.</span>
<span class="c1">#</span>
<span class="c1"># Polyfemos is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="c1"># WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR</span>
<span class="c1"># A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more</span>
<span class="c1"># details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License and</span>
<span class="c1"># GNU General Public License along with Polyfemos. If not, see</span>
<span class="c1"># &lt;https://www.gnu.org/licenses/&gt;.&#39;</span>
<span class="c1">#</span>
<span class="c1"># Author: Henrik Jänkävaara</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains :class:`~polyfemos.back.interpreter.Interpreter` for reading</span>
<span class="sd">&#39;\*conf&#39; files</span>

<span class="sd">:copyright:</span>
<span class="sd">    2019, University of Oulu, Sodankyla Geophysical Observatory</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License v3.0 or later</span>
<span class="sd">    (https://spdx.org/licenses/LGPL-3.0-or-later.html)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">import</span> <span class="nn">pathos.multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">UTCDateTime</span>

<span class="kn">from</span> <span class="nn">polyfemos.parser</span> <span class="k">import</span> <span class="n">typeoperator</span> <span class="k">as</span> <span class="n">to</span>
<span class="kn">from</span> <span class="nn">polyfemos.util.messenger</span> <span class="k">import</span> <span class="n">messenger</span><span class="p">,</span> <span class="n">debugger</span>
<span class="kn">from</span> <span class="nn">polyfemos.util</span> <span class="k">import</span> <span class="n">fileutils</span>
<span class="kn">from</span> <span class="nn">polyfemos.parser</span> <span class="k">import</span> <span class="n">resources</span>
<span class="kn">from</span> <span class="nn">polyfemos.back.seismic</span> <span class="k">import</span> <span class="n">lumberjack</span><span class="p">,</span> <span class="n">scanner</span>
<span class="kn">from</span> <span class="nn">polyfemos.back.parameter</span> <span class="k">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">polyfemos.back.station</span> <span class="k">import</span> <span class="n">Station</span><span class="p">,</span> <span class="n">Stations</span>


<div class="viewcode-block" id="pool_error_callback"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.html#polyfemos.back.interpreter.pool_error_callback">[docs]</a><span class="k">def</span> <span class="nf">pool_error_callback</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to be called during pool worker error</span>

<span class="sd">    :type arg:</span>
<span class="sd">    :param arg: Error message</span>
<span class="sd">    :type msg: str, optional</span>
<span class="sd">    :param msg: Additional message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;while using multiprocessing</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">showpid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_quit"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.html#polyfemos.back.interpreter.check_quit">[docs]</a><span class="k">def</span> <span class="nf">check_quit</span><span class="p">(</span><span class="n">func_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator to be used with methods of class</span>
<span class="sd">    :class:`~polyfemos.back.interpreter.Interpreter`. If the class</span>
<span class="sd">    attribute ``self._quit`` is set to ``False``, the decorated methods</span>
<span class="sd">    do nothing.</span>

<span class="sd">    :type func\_: func</span>
<span class="sd">    :param func\_:</span>
<span class="sd">    :rtype: func</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func_</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quit</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span></div>


<div class="viewcode-block" id="Interpreter"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter">[docs]</a><span class="k">class</span> <span class="nc">Interpreter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for reading &#39;\*.conf&#39; files</span>

<span class="sd">    Contents of the &#39;\*.conf&#39; files are</span>
<span class="sd">    interpreted at run time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Interpreter.__init__"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the global program starttime, ``self.__now``.</span>
<span class="sd">        Calls :meth:`~polyfemos.back.interpreter.Interpreter._init_timedict`</span>
<span class="sd">        to initialize ``self.__timedict``.</span>

<span class="sd">        Creates empty :class:`~polyfemos.back.station.Stations()` instance</span>
<span class="sd">        (``self.station``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__now</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stations</span> <span class="o">=</span> <span class="n">Stations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scopes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># reader location message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_conf_folder</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_flags</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_timedict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_funcs_and_commands</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__now</span><span class="p">)</span>

        <span class="n">messenger</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
        <span class="n">messenger</span><span class="p">(</span><span class="s2">&quot;Program starttime: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__now</span><span class="p">),</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter._init_timedict"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter._init_timedict">[docs]</a>    <span class="k">def</span> <span class="nf">_init_timedict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets &#39;thisstarttime&#39; and &#39;laststarttime&#39; values to</span>
<span class="sd">        ``self.__now``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__timedict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;thisstarttime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__now</span><span class="p">,</span>
            <span class="s2">&quot;laststarttime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__now</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="Interpreter._init_flags"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter._init_flags">[docs]</a>    <span class="k">def</span> <span class="nf">_init_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ititializes ``self.__flags`` and ``self.flags`` dictionaries.</span>
<span class="sd">        ``self.__flags`` consists of flag types and default values.</span>
<span class="sd">        ``self.flags`` will store the flag values, changed or default.</span>

<span class="sd">        If default value of the FLAG is ``None``, the user most likely needs</span>
<span class="sd">        to provide correct value in the &#39;\*.conf&#39; file.</span>

<span class="sd">        All available FLAGs, their types and default values:</span>

<span class="sd">        .. rubric:: sohtextfilepath</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.filepath`, ``None``,</span>
<span class="sd">        Filepath of the output &#39;\*.stf&#39; file. Do not include</span>
<span class="sd">        file extension when defining the path, the corresponding</span>
<span class="sd">        extension will be automatically included.</span>


<span class="sd">        .. rubric:: sohalertpath</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.filepath`, ``None``,</span>
<span class="sd">        Filepath of the output &#39;\*.alert&#39; file. Do not include</span>
<span class="sd">        file extension when defining the path, the corresponding</span>
<span class="sd">        extension will be automatically included.</span>


<span class="sd">        .. rubric:: sohcsvpath</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.filepath`, ``None``,</span>
<span class="sd">        Filepath of the output &#39;\*.csv&#39; file. Do not include</span>
<span class="sd">        file extension when defining the path, the corresponding</span>
<span class="sd">        extension will be automatically included.</span>


<span class="sd">        .. rubric:: wait_after_midnight</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.int_`, ``0``,</span>
<span class="sd">        Given in seconds. As the START command is called, if difference</span>
<span class="sd">        between current program starttime and midnight is lesser</span>
<span class="sd">        than this value, program execution is halted</span>
<span class="sd">        (without saving any starttime values).</span>


<span class="sd">        .. rubric:: write_sohalertfile</span>

<span class="sd">        [not in use]</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``True``,</span>
<span class="sd">        Defines if &#39;\*.alert&#39; file is created/updated</span>


<span class="sd">        .. rubric:: write_sohtextfile</span>

<span class="sd">        [not in use]</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``True``,</span>
<span class="sd">        Defines if &#39;\*.stf&#39; file is created/updated</span>


<span class="sd">        .. rubric:: write_sohcsvfile</span>

<span class="sd">        [not in use]</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``True``,</span>
<span class="sd">        Defines if &#39;\*.csv&#39; file is created/updated</span>


<span class="sd">        .. rubric:: retroactive</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``False``</span>

<span class="sd">        If ``False``, appends lines to previously created files.</span>
<span class="sd">        One new line per station-parameter combination.</span>

<span class="sd">        If ``True``, creates &#39;\*.stf&#39; and &#39;\*.csv&#39; files from scratch,</span>
<span class="sd">        Files created retroactively, have an additional &#39;retro&#39;</span>
<span class="sd">        identifier in the filename. Retroactive option</span>
<span class="sd">        overwrites previously created &#39;retro&#39;-files.</span>


<span class="sd">        .. rubric:: save_starttime</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``False``,</span>
<span class="sd">        Defines if current program starttime is saved to &#39;laststarttime&#39;</span>
<span class="sd">        when program execution is finished</span>


<span class="sd">        .. rubric:: realtimeness_limit</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.int_`, ``0``,</span>
<span class="sd">        Given in seconds, for datacoverage parameters (codes &#39;DCD&#39; and</span>
<span class="sd">        &#39;DCL&#39;), defines the time interval in which the data is still</span>
<span class="sd">        considered to be in &quot;realtime&quot;. See</span>
<span class="sd">        :func:`~polyfemos.back.seismic.lumberjack._data_coverage`</span>
<span class="sd">        for more info.</span>


<span class="sd">        .. rubric:: average_calc_length</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.int_`, ``1``,</span>
<span class="sd">        Sets the ``average_calc_length`` in</span>
<span class="sd">        :func:`~polyfemos.back.seismic.lumberjack.data_timing_quality`,</span>
<span class="sd">        which is used for codes &#39;XXX.TQ&#39;.</span>


<span class="sd">        .. rubric:: execution_time_file</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.staticfilepath`, ``None``,</span>
<span class="sd">        A pickle file where &#39;thisstarttime&#39; and &#39;laststarttime&#39; program</span>
<span class="sd">        starttime values are saved and available for reference via</span>
<span class="sd">        this FLAG during program execution. Include the full path in the</span>
<span class="sd">        definition including the extension (\*.pkl).</span>


<span class="sd">        .. rubric:: multiprocessing</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.bool_`, ``True``,</span>
<span class="sd">        Defines if multiprocessing is used or not.</span>


<span class="sd">        .. rubric:: max_processes</span>

<span class="sd">        :func:`~polyfemos.parser.typeoperator.int_`, ``4``,</span>
<span class="sd">        Maximum number of CPUs used for multiprocessing,</span>
<span class="sd">        see :meth:`~polyfemos.back.interpreter.Interpreter._init_pool` for</span>
<span class="sd">        more info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;sohtextfilepath&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;sohalertpath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;sohcsvpath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;wait_after_midnight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;write_sohalertfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;write_sohtextfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;write_sohcsvfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;retroactive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;save_starttime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;realtimeness_limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;average_calc_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;execution_time_file&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">staticfilepath</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;multiprocessing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="s2">&quot;max_processes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

        <span class="c1"># copy values from self.__flags to self.flags</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Interpreter._init_pool"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter._init_pool">[docs]</a>    <span class="k">def</span> <span class="nf">_init_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes ``self.pool``</span>
<span class="sd">        (:class:`~pathos.multiprocessing.ProcessPool`)</span>
<span class="sd">        attribute. Sets the maximum amount of CPUs used by the pool,</span>
<span class="sd">        this is defined with the FLAG `max_processes`.</span>
<span class="sd">        Two CPUs are left unused if possible (i.e. the machine has 3 or more</span>
<span class="sd">        CPUs). In every case the pool will use at least 1 CPU.</span>
<span class="sd">        See :meth:`~polyfemos.back.interpreter.Interpreter.apply_async`</span>
<span class="sd">        for more info.</span>

<span class="sd">        If ``self.pool`` is already initialized, do nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">maxprocs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">maxprocs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxprocs</span><span class="p">)</span>
        <span class="n">maxprocs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;max_processes&quot;</span><span class="p">],</span> <span class="n">maxprocs</span><span class="p">)</span>
        <span class="n">maxprocs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxprocs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">maxprocs</span><span class="p">,</span> <span class="n">maxtasksperchild</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.replace_var"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.replace_var">[docs]</a>    <span class="k">def</span> <span class="nf">replace_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param key: the name of the variable starting with the variable symbol</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :return: Anything contained in ``self.vars[key]``, if ``key`` is</span>
<span class="sd">            previously defined variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">SYMBOLS</span><span class="p">[</span><span class="s2">&quot;VAR&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Interpreter.save_starttime"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.save_starttime">[docs]</a>    <span class="k">def</span> <span class="nf">save_starttime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If ``tolast`` is ``False``, loads the &#39;laststarttime&#39; value from the</span>
<span class="sd">        pklfile (FLAG `execution_time_file`) before saving the</span>
<span class="sd">        ``self.__timedict``. After this the &#39;laststarttime&#39; should be</span>
<span class="sd">        unchanged, and &#39;thisstarttime&#39; should contain the starttime of this</span>
<span class="sd">        exact program run.</span>

<span class="sd">        If ``tolast`` is ``True``, the value of &#39;thisstarttime&#39; is saved</span>
<span class="sd">        to &#39;laststarttime&#39;.</span>

<span class="sd">        :type tolast: bool, optional</span>
<span class="sd">        :param tolast: defaults to ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pklfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;execution_time_file&#39;</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
        <span class="k">if</span> <span class="n">pklfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;FLAG </span><span class="se">\&#39;</span><span class="s2">execution_time_file</span><span class="se">\&#39;</span><span class="s2"> undefined&quot;</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pklfile</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;FLAG </span><span class="se">\&#39;</span><span class="s2">execution_time_file</span><span class="se">\&#39;</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pklfile</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Directory does not exist&quot;</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pklfile</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tolast</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_timedict</span><span class="p">()</span>
            <span class="n">fileutils</span><span class="o">.</span><span class="n">save_obj</span><span class="p">(</span><span class="n">pklfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timedict</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">loaded_dict</span> <span class="o">=</span> <span class="n">fileutils</span><span class="o">.</span><span class="n">load_obj</span><span class="p">(</span><span class="n">pklfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;laststarttime&quot;</span> <span class="ow">in</span> <span class="n">loaded_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__timedict</span><span class="p">[</span><span class="s2">&quot;laststarttime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loaded_dict</span><span class="p">[</span><span class="s2">&quot;laststarttime&quot;</span><span class="p">]</span>
        <span class="n">fileutils</span><span class="o">.</span><span class="n">save_obj</span><span class="p">(</span><span class="n">pklfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timedict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.apply_async"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.apply_async">[docs]</a>    <span class="k">def</span> <span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously calls ``func_`` with ``args`` using</span>
<span class="sd">        :class:`~pathos.multiprocessing.ProcessPool` (alias of</span>
<span class="sd">        ``multiprocess.pool.Pool`` from</span>
<span class="sd">        `multiprocess &lt;https://pypi.org/project/multiprocess/&gt;`_). Additional</span>
<span class="sd">        information in Python&#39;s own multiprocessing package</span>
<span class="sd">        :obj:`~multiprocessing.pool.Pool`.</span>

<span class="sd">        If ``deepcopy`` and</span>
<span class="sd">        ``self.flags[&quot;multiprocessing&quot;]`` are both ``False``, the function is</span>
<span class="sd">        called normally ``func_(*args)``.</span>

<span class="sd">        :type func\_: func</span>
<span class="sd">        :param func\_:</span>
<span class="sd">        :type args: list</span>
<span class="sd">        :param args: arguments to the ``func_``</span>
<span class="sd">        :type deepcopy: bool, optional</span>
<span class="sd">        :param deepcopy: defaults to ``True``, only used if multiprocessing</span>
<span class="sd">            is not used. If ``True``, the ``args`` are deepcopied before</span>
<span class="sd">            calling the ``func_``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;multiprocessing&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_pool</span><span class="p">()</span>
            <span class="n">_ecb</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">pool_error_callback</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">func_</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">error_callback</span><span class="o">=</span><span class="n">_ecb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deepcopy</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="n">func_</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.close_and_join"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.close_and_join">[docs]</a>    <span class="k">def</span> <span class="nf">close_and_join</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If ``self.pool`` is previously set up, terminates the pool workers by</span>
<span class="sd">        calling methods close and join.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></div>

    <span class="c1">###</span>
    <span class="c1"># Functions available using commands</span>
    <span class="c1">###</span>

<div class="viewcode-block" id="Interpreter.readfile"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.readfile">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">readfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conffile</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and interprets contents of the &#39;\*.conf&#39; files.</span>

<span class="sd">        :type conffile: str</span>
<span class="sd">        :param conffile: path to &#39;\*.conf&#39; file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_conf_folder</span><span class="p">,</span> <span class="n">conffile</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Reading conffile: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span>
        <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">conffile</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Given conffile (</span><span class="si">{}</span><span class="s2">) does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__current_conf_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">fileutils</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span>

        <span class="n">linenbr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">linenbr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># remove linebreaks and whitespaces at start and end of the row</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># If row does not start with \ skip the row</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">resources</span><span class="o">.</span><span class="n">SYMBOLS</span><span class="p">[</span><span class="s2">&quot;CMD&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="c1"># save file and line information for debugging</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span> <span class="o">=</span> <span class="s2">&quot;File </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">, line </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conffile</span><span class="p">,</span> <span class="n">linenbr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span> <span class="o">+=</span> <span class="s2">&quot;  </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c1"># Remove everything from the row after #-symbol</span>
            <span class="k">if</span> <span class="n">resources</span><span class="o">.</span><span class="n">SYMBOLS</span><span class="p">[</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="n">row</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">SYMBOLS</span><span class="p">[</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">])]</span>
            <span class="c1"># Split the row according the whitespaces</span>
            <span class="c1"># and remove extra whitespaces</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">]</span>

            <span class="n">command</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># Check if given command is defined</span>
            <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Unidentified command </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Check if any station definition is before parameter definition</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;PAR&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Trying to add parameter before station.&quot;</span>
                <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># extract list of functions to be applied to arguments</span>
            <span class="n">argtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="p">][</span><span class="s1">&#39;argtypes&#39;</span><span class="p">][:]</span>

            <span class="c1"># If RUN command is used</span>
            <span class="c1"># Check if called function exists and modify argument types</span>
            <span class="c1"># accordingly</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;RUN&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Using command </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2">, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;RUN&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argtypes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;no function name given&quot;</span>
                    <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;no function </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> available&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">argtypes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;argtypes&#39;</span><span class="p">]</span>

            <span class="c1"># Check if correct amount of arguments is given, raise error if not</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argtypes</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Invalid amount of arguments with given &quot;</span> \
                    <span class="s2">&quot;command </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;RUN&quot;</span><span class="p">]:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;with function </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Arguments given </span><span class="si">{}</span><span class="s2">, should be </span><span class="si">{}</span><span class="s2">&quot;</span> \
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">argtypes</span><span class="p">))</span>
                <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">newargs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replace_var</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Variable </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> at index </span><span class="si">{}</span><span class="s2"> is not defined.&quot;</span> \
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="c1"># Convert arguments into their rightful types</span>
            <span class="c1"># raise error if conversion is not possible</span>
            <span class="n">newargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">argtypes</span><span class="p">,</span> <span class="n">newargs</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Argument with invalid type or syntax</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Given </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> at index </span><span class="si">{}</span><span class="s2">, should be of type </span><span class="si">{}</span><span class="s2">&quot;</span> \
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">argtypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="p">][</span><span class="s1">&#39;func&#39;</span><span class="p">](</span><span class="o">*</span><span class="n">newargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.define_flag"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.define_flag">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">define_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type flag: str</span>
<span class="sd">        :param flag: name of the FLAG</span>
<span class="sd">        :type value:</span>
<span class="sd">        :param value: value of the FLAG, the type depends on the flag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;No FLAG </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> available.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flags</span><span class="p">[</span><span class="n">flag</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">](</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.define_var"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.define_var">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">define_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param key: variable name</span>
<span class="sd">        :type value: str</span>
<span class="sd">        :param value: value to be set to variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Interpreter.add_station"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.add_station">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">add_station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to define and add a station</span>
<span class="sd">        (:class:`~polyfemos.back.station.Station`)</span>
<span class="sd">        instance to ``self.stations``. ``args`` are passed straight to the</span>
<span class="sd">        :meth:`~polyfemos.back.station.Station.__init__`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">station</span> <span class="o">=</span> <span class="n">Station</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">add_station</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rlm</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Unable to add station with id </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Start or endtimes overlap&quot;</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Interpreter.add_par"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.add_par">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">add_par</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates :class:`~polyfemos.back.parameter.Parameter`</span>
<span class="sd">        instance and adds it to the most recently defined station in</span>
<span class="sd">        ``self.stations``. ``args`` are passed straight to the</span>
<span class="sd">        :meth:`~polyfemos.back.parameter.Parameter.__init__`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="Interpreter.exit_scope"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.exit_scope">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">exit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effectively does nothing at the moment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scopes</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Interpreter.call_func"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.call_func">[docs]</a>    <span class="nd">@debugger</span>
    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">call_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">funckey</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls function available in ``self.functions``.</span>

<span class="sd">        ``args`` are the</span>
<span class="sd">        arguments passed to the function ``self.functions[funckey][&#39;func&#39;]``.</span>

<span class="sd">        :type funckey: str</span>
<span class="sd">        :param funckey: name of the function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">funckey</span><span class="p">][</span><span class="s1">&#39;func&#39;</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="Interpreter.start"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.start">[docs]</a>    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Program execution is halted if the difference between program</span>
<span class="sd">        starttime and midnight is lesser than value of the FLAG</span>
<span class="sd">        &#39;wait_after_midnight&#39;.</span>

<span class="sd">        Saves the current program starttime to &#39;thisstarttime&#39;.</span>
<span class="sd">        see :meth:`~polyfemos.back.interpreter.Interpreter.save_starttime`</span>
<span class="sd">        for more info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">midnight</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%j&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__now</span> <span class="o">-</span> <span class="n">midnight</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;wait_after_midnight&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">save_starttime</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_starttime</span><span class="p">()</span></div>

<div class="viewcode-block" id="Interpreter.stop"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.stop">[docs]</a>    <span class="nd">@check_quit</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quit_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_starttime</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type quit\_: bool, optional</span>
<span class="sd">        :param quit\_: defaults to ``True``, If ``True`` the program does</span>
<span class="sd">            nothing anymore.</span>
<span class="sd">        :type save_starttime: bool, optional</span>
<span class="sd">        :param save_starttime: defaults to ``True``, In order to save</span>
<span class="sd">            starttime value, ``save_starttime`` and FLAG &#39;save_starttime&#39;</span>
<span class="sd">            both are required to be ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timedict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">messenger</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_and_join</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save_starttime</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;save_starttime&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_starttime</span><span class="p">(</span><span class="n">tolast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quit_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_quit</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1">###</span>
    <span class="c1"># Functions available using RUN command</span>
    <span class="c1">###</span>

<div class="viewcode-block" id="Interpreter.data_coverage_image"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.data_coverage_image">[docs]</a>    <span class="nd">@debugger</span>
    <span class="k">def</span> <span class="nf">data_coverage_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :func:`~polyfemos.back.seismic.scanner.data_coverage_image`</span>
<span class="sd">        with ``self.flags`` and ``args``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">scanner</span><span class="o">.</span><span class="n">data_coverage_image</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="Interpreter.plot_ppsd"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.plot_ppsd">[docs]</a>    <span class="nd">@debugger</span>
    <span class="k">def</span> <span class="nf">plot_ppsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        ``args``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Interpreter.process_logs"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter.process_logs">[docs]</a>    <span class="nd">@debugger</span>
    <span class="k">def</span> <span class="nf">process_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes all stations in ``self.stations``.</span>
<span class="sd">        Calls :func:`~polyfemos.back.seismic.lumberjack.process_logs`</span>
<span class="sd">        with ``self.flags``, ``self.stations``, and ``args``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">lumberjack</span><span class="o">.</span><span class="n">process_logs</span><span class="p">,</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stations</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="Interpreter._init_funcs_and_commands"><a class="viewcode-back" href="../../../autogen/polyfemos.back.interpreter.Interpreter.html#polyfemos.back.interpreter.Interpreter._init_funcs_and_commands">[docs]</a>    <span class="k">def</span> <span class="nf">_init_funcs_and_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">today</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All possible commands in addition to functions called using the</span>
<span class="sd">        &#39;RUN&#39; command are defined here. Additionally, the amount of arguments</span>
<span class="sd">        and their types for each function and command is defined.</span>

<span class="sd">        If today special variable is used in case of types</span>
<span class="sd">        :func:`~polyfemos.parser.typeoperator.ordinal` or</span>
<span class="sd">        :func:`~polyfemos.parser.typeoperator.utcdatetime`,</span>
<span class="sd">        the variable is replaced with</span>
<span class="sd">        the value of ``today``.</span>

<span class="sd">        :type today: :class:`~obspy.core.utcdatetime.UTCDateTime`</span>
<span class="sd">        :param today:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set TODAY special variable correctly when type is</span>
        <span class="c1"># ordinal or utcdatime</span>
        <span class="n">_ordinal</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">ordinal</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="n">today</span><span class="p">)</span>
        <span class="n">_utcdatetime</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">utcdatetime</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="n">today</span><span class="p">)</span>
        <span class="c1"># Functions available using RUN command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;process_logs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_logs</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">_ordinal</span><span class="p">,</span> <span class="n">_ordinal</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">strlist</span><span class="p">]},</span>
            <span class="s2">&quot;data_coverage_image&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_coverage_image</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">_utcdatetime</span><span class="p">,</span> <span class="n">_utcdatetime</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">strlist</span><span class="p">,</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">strlist</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">]},</span>
        <span class="p">}</span>
        <span class="c1"># Commads available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;IMPORT&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readfile</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;FLAG&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_flag</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;VAR&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_var</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;END&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;START&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;STOP&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;RUN&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;STATION&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_station</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">float_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">float_</span><span class="p">,</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">_ordinal</span><span class="p">,</span> <span class="n">_ordinal</span><span class="p">]},</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">CMDS</span><span class="p">[</span><span class="s2">&quot;PAR&quot;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_par</span><span class="p">,</span>
                <span class="s1">&#39;argtypes&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">float_</span><span class="p">,</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">floatlist</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">floatlist</span><span class="p">,</span>
                    <span class="n">to</span><span class="o">.</span><span class="n">floatlist</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">filepath</span><span class="p">]},</span>
        <span class="p">}</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../documentation_index.html">polyfemos</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">readme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_0_general.html">General Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_1_setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_2_backend.html">Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_3_frontend.html">Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_4_add_station.html">How to add a station</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polyfemos_readme_5_sohemailer.html">State of health emailer</a></li>
</ul>
<p class="caption"><span class="caption-text">modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../back.html">Backend modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../front.html">Frontend modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">Scripts, tests and other modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../documentation_index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, University of Oulu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>